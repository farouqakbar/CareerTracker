<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile ‚Äî CareerTracker</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" />
  <link rel="stylesheet" href="../assets/css/base.css" />
  <link rel="stylesheet" href="../assets/css/layout.css" />
  <link rel="stylesheet" href="../assets/css/modal.css" />
  <link rel="stylesheet" href="../assets/css/mobile.css" />
  <link rel="stylesheet" href="../assets/css/theme.css" />
  <script>
    (function () {
      const saved = localStorage.getItem("theme");
      if (saved === "dark") document.documentElement.setAttribute("data-theme", "dark");
    })();
  </script>
  <style>
    .profile-page {
      max-width: 780px;
      margin: 0 auto;
      padding: calc(var(--topbar-h) + 2.5rem) 1.5rem 4rem;
    }
    .page-header { margin-bottom: 2rem; }
    .page-header h1 { font-size: 1.5rem; font-weight: 800; color: var(--dark); letter-spacing: -0.03em; }
    .page-header p { font-size: 0.85rem; color: var(--muted); margin-top: 0.25rem; }

    /* Avatar hero card */
    .avatar-card {
      background: linear-gradient(135deg, #1a1d2e 0%, #2d3252 100%);
      border-radius: var(--radius-lg);
      padding: 2.5rem 2rem;
      margin-bottom: 1.25rem;
      display: flex;
      align-items: center;
      gap: 2rem;
      position: relative;
      overflow: hidden;
    }
    .avatar-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at 80% 50%, rgba(92,102,122,0.3) 0%, transparent 60%);
    }
    .avatar-card::after {
      content: "";
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--brand) 0%, #7c8aff 50%, var(--accent) 100%);
    }
    .avatar-wrap { position: relative; z-index: 1; flex-shrink: 0; }
    .profile-photo-display {
      width: 96px; height: 96px;
      border-radius: 50%; overflow: hidden;
      background: rgba(255,255,255,0.08);
      border: 3px solid rgba(255,255,255,0.15);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.35);
    }
    .profile-photo-display svg, .profile-photo-img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .avatar-meta { position: relative; z-index: 1; flex: 1; min-width: 0; }
    .avatar-meta h2 { font-size: 1.25rem; font-weight: 800; color: white; letter-spacing: -0.02em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .avatar-meta .username-tag { font-size: 0.78rem; color: rgba(255,255,255,0.45); margin-top: 0.25rem; }
    .avatar-actions { position: relative; z-index: 1; display: flex; flex-direction: column; gap: 0.5rem; }
    .avatar-btn {
      display: inline-flex; align-items: center; gap: 0.4rem;
      padding: 0.45rem 0.875rem; border-radius: 2rem;
      font-size: 0.78rem; font-weight: 600; font-family: "Poppins", sans-serif;
      cursor: pointer; transition: all 0.2s; border: none; white-space: nowrap;
    }
    .avatar-btn.upload { background: rgba(255,255,255,0.12); color: white; border: 1px solid rgba(255,255,255,0.2); }
    .avatar-btn.upload:hover { background: rgba(255,255,255,0.22); }
    .avatar-btn.remove { background: rgba(239,68,68,0.12); color: #fca5a5; border: 1px solid rgba(239,68,68,0.2); }
    .avatar-btn.remove:hover { background: rgba(239,68,68,0.25); }
    input[type="file"]#photoInput { display: none; }

    /* Settings card */
    .settings-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm); margin-bottom: 1.25rem; }
    .settings-card-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); background: var(--card-bg); }
    .settings-card-header h3 { font-size: 0.85rem; font-weight: 700; color: var(--dark); text-transform: uppercase; letter-spacing: 0.5px; }
    .settings-card-body { padding: 1.5rem; display: flex; flex-direction: column; gap: 1.25rem; }
    .field-group { display: flex; flex-direction: column; gap: 0.35rem; }
    .field-group label { font-size: 0.72rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.6px; }
    .field-input {
      width: 100%; padding: 0.7rem 1rem;
      border: 1.5px solid var(--border); border-radius: var(--radius-md);
      font-size: 0.9rem; font-family: "Poppins", sans-serif;
      color: var(--text); background: var(--surface); outline: none;
      transition: border-color 0.2s, box-shadow 0.2s; box-sizing: border-box;
    }
    .field-input:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(92, 102, 122, 0.1); }
    .field-input:disabled { background: var(--card-bg); color: var(--muted); cursor: not-allowed; }
    .field-hint { font-size: 0.72rem; color: var(--muted); margin-top: 0.2rem; }
    .action-row { display: flex; gap: 0.75rem; padding: 1.25rem 1.5rem; border-top: 1px solid var(--border); background: var(--card-bg); }
    .btn-save { padding: 0.65rem 1.75rem; background: var(--brand); color: white; border: none; border-radius: var(--radius-md); font-size: 0.875rem; font-weight: 700; font-family: "Poppins", sans-serif; cursor: pointer; transition: all 0.2s; }
    .btn-save:hover { background: var(--brand-dark); transform: translateY(-1px); box-shadow: 0 4px 14px rgba(92,102,122,0.3); }
    .btn-cancel { padding: 0.65rem 1.25rem; background: transparent; color: var(--muted); border: 1.5px solid var(--border); border-radius: var(--radius-md); font-size: 0.875rem; font-weight: 600; font-family: "Poppins", sans-serif; cursor: pointer; transition: all 0.2s; }
    .btn-cancel:hover { border-color: var(--brand); color: var(--brand); }

    /* Danger zone */
    .danger-card { background: rgba(239,68,68,0.03); border: 1px solid rgba(239,68,68,0.15); border-radius: var(--radius-lg); padding: 1.25rem 1.5rem; }
    .danger-card h4 { font-size: 0.78rem; font-weight: 700; color: var(--red); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem; }
    .danger-card p { font-size: 0.82rem; color: var(--muted); margin-bottom: 1rem; }
    .btn-danger { padding: 0.55rem 1.25rem; background: rgba(239,68,68,0.08); color: var(--red); border: 1.5px solid rgba(239,68,68,0.25); border-radius: 2rem; font-size: 0.82rem; font-weight: 600; font-family: "Poppins", sans-serif; cursor: pointer; transition: all 0.2s; }
    .btn-danger:hover { background: var(--red); color: white; border-color: var(--red); }

    [data-theme="dark"] .avatar-card { background: linear-gradient(135deg, #252a40 0%, #1e2235 100%); }
    [data-theme="dark"] .field-input { background: var(--card-bg); border-color: var(--border); }
    @media (max-width: 600px) {
      .profile-page { padding: calc(var(--topbar-h) + 1.25rem) 1rem 3rem; }
      .avatar-card { flex-direction: column; align-items: flex-start; gap: 1.25rem; padding: 1.75rem 1.25rem; }
      .avatar-actions { flex-direction: row; }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="left-section">
      <div id="toggleBtn">‚ò∞</div>
      <a href="home.html" class="logo">Career<span>Tracker</span></a>
    </div>
    <div class="right-section">
      <button id="darkModeToggle" title="Toggle dark mode" aria-label="Toggle dark mode">üåô</button>
      <div class="profile" id="profileBtn">
        <span id="topbarDisplayName">-</span>
        <div class="avatar" id="topbarAvatar"></div>
      </div>
    </div>
  </header>

  <aside class="sidebar" id="sidebar">
    <div class="menu">
      <a href="home.html"       class="menu-item" data-title="Home">üè† <span>Home</span></a>
      <a href="how-to-use.html" class="menu-item" data-title="How to Use">üìñ <span>How to Use</span></a>
      <a href="about.html"      class="menu-item" data-title="About">‚ÑπÔ∏è <span>About</span></a>
    </div>
  </aside>
  <div id="sidebarOverlay"></div>

  <div class="profile-dropdown" id="dropdown">
    <div>üë§ Profile</div>
    <div id="cvLink">üìÑ My CV</div>
    <hr />
    <div class="logout">üö™ Sign Out</div>
  </div>

  <main class="main" id="main">
    <div class="profile-page">
      <div class="page-header">
        <h1>Profile Settings</h1>
        <p>Manage your account information and preferences.</p>
      </div>

      <div class="avatar-card">
        <div class="avatar-wrap">
          <div class="profile-photo-display" id="photoDisplay">
            <svg id="defaultAvatar" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
              <circle cx="50" cy="50" r="50" fill="#3d4a5f" />
              <circle cx="50" cy="35" r="20" fill="#5c667a" />
              <ellipse cx="50" cy="70" rx="30" ry="25" fill="#5c667a" />
            </svg>
            <img id="profilePhotoPreview" src="" alt="Profile Photo" class="profile-photo-img" style="display:none" />
          </div>
        </div>
        <div class="avatar-meta">
          <h2 id="avatarDisplayName">‚Äî</h2>
          <div class="username-tag" id="avatarUsername">@username</div>
        </div>
        <div class="avatar-actions">
          <input type="file" id="photoInput" accept="image/*" />
          <button class="avatar-btn upload" id="uploadPhotoBtn">üì∑ Upload Photo</button>
          <button class="avatar-btn remove" id="removePhotoBtn">‚úï Remove</button>
        </div>
      </div>

      <div class="settings-card">
        <div class="settings-card-header">
          <h3>üë§ Account Information</h3>
        </div>
        <div class="settings-card-body">
          <div class="field-group">
            <label>Username</label>
            <input type="text" id="usernameDisplay" class="field-input" disabled />
            <span class="field-hint">Username cannot be changed after registration.</span>
          </div>
          <div class="field-group">
            <label>Display Name</label>
            <input type="text" id="displayNameInput" class="field-input" placeholder="Enter your display name" />
            <span class="field-hint">This name will appear across the app.</span>
          </div>
        </div>
        <div class="action-row">
          <button id="saveProfileBtn" class="btn-save">Save Changes</button>
          <button id="cancelProfileBtn" class="btn-cancel">Cancel</button>
        </div>
      </div>

      <div class="danger-card">
        <h4>‚ö†Ô∏è Danger Zone</h4>
        <p>Once you delete your account, all your data will be permanently removed. This cannot be undone.</p>
        <button class="btn-danger">üóëÔ∏è Delete Account</button>
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script src="../assets/js/supabaseClient.js"></script>
  <script src="../assets/js/auth.js"></script>
  <script src="../assets/js/ui.js"></script>
  <script src="../assets/js/main.js"></script>
  <script src="../assets/js/profilePage.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const btn = document.getElementById("darkModeToggle");
      const html = document.documentElement;
      function updateIcon() {
        const isDark = html.getAttribute("data-theme") === "dark";
        btn.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
      }
      updateIcon();
      btn.addEventListener("click", function () {
        const isDark = html.getAttribute("data-theme") === "dark";
        if (isDark) { html.removeAttribute("data-theme"); localStorage.setItem("theme", "light"); }
        else        { html.setAttribute("data-theme", "dark"); localStorage.setItem("theme", "dark"); }
        updateIcon();
      });
      // Sync avatar hero with form values
      function syncAvatarMeta() {
        const dn = document.getElementById("displayNameInput");
        const un = document.getElementById("usernameDisplay");
        const an = document.getElementById("avatarDisplayName");
        const au = document.getElementById("avatarUsername");
        if (an && dn) an.textContent = dn.value || "‚Äî";
        if (au && un) au.textContent = "@" + (un.value || "username");
      }
      const displayInput = document.getElementById("displayNameInput");
      if (displayInput) displayInput.addEventListener("input", syncAvatarMeta);
      setTimeout(syncAvatarMeta, 600);
      setInterval(syncAvatarMeta, 1200);
    });
  </script>
</body>
</html>
