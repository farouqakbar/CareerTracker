<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Application Detail</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" />
    <link rel="stylesheet" href="../assets/css/base.css" />
    <link rel="stylesheet" href="../assets/css/layout.css" />
    <link rel="stylesheet" href="../assets/css/sidebar.css" />
    <link rel="stylesheet" href="../assets/css/modal.css" />
    <link rel="stylesheet" href="../assets/css/applied.css" />
    <link rel="stylesheet" href="../assets/css/application-detail.css" />
    <link rel="stylesheet" href="../assets/css/timeline.css" />
    <link rel="stylesheet" href="../assets/css/mobile.css" />
    <link rel="stylesheet" href="../assets/css/theme.css" />
    <script>
      // Apply saved theme immediately to avoid flash
      (function() {
        const saved = localStorage.getItem('theme');
        if (saved === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
      })();
    </script>
  </head>
  <body>
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="left-section">
        <div id="toggleBtn">â˜°</div>
        <div class="logo">Career<span>Tracker</span></div>
      </div>
      <div class="right-section">
        <button id="darkModeToggle" title="Toggle dark mode" aria-label="Toggle dark mode">ğŸŒ™</button>
        <div class="profile" id="profileBtn">
          <span id="topbarDisplayName">-</span>
          <div class="avatar" id="topbarAvatar"></div>
        </div>
      </div>
    </header>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="menu">
        <a href="home.html" class="menu-item" data-title="Home">ğŸ  <span>Home</span></a>
        <a href="applied.html" class="menu-item" data-title="Applied">ğŸ“„ <span>Applied</span></a>
        <a href="jobs.html" class="menu-item" data-title="Job Vacancy">ğŸ“ <span>Job Vacancy</span></a>
      </div>
    </aside>
    <div id="sidebarOverlay"></div>

    <!-- PROFILE DROPDOWN -->
    <div class="profile-dropdown" id="dropdown">
      <div>ğŸ‘¤ Profile</div>
      <div id="cvLink">ğŸ“„ My CV</div>
      <hr />
      <div class="logout">ğŸšª Sign Out</div>
    </div>

    <!-- MAIN -->
    <main class="main" id="main">
      <section class="application-info">

        <!-- Header: Back + Title only (no delete icon here) -->
        <div class="header-actions">
          <div id="backBtn" title="Back" class="back-icon">â†</div>
          <h2>Application Info</h2>
        </div>

        <!-- App Summary Card -->
        <div class="app-summary" style="position: relative">
          <div class="company-name">
            <h1></h1>
            <h3></h3>
          </div>
          <div class="detail-actions" style="position: relative">
            <span id="editStages" class="edit-stages" title="Edit stages">âœ</span>
            <div class="add-btn" title="Add stage">+</div>
            <span id="selectCompany" class="select-company" title="Switch application">â–¼</span>
            <div id="companyDropdown" class="company-dropdown" style="display: none"></div>
          </div>
        </div>

        <!-- Timeline -->
        <div class="timeline"></div>

        <!-- Stage Detail Box -->
        <div class="stage-box">
          <h3></h3>
          <span id="noteEdit" class="note-edit">âœ</span>
          <p><strong>Deadline :</strong> <span id="detailDeadline"></span></p>
          <p><strong>Note :</strong></p>
          <div class="notes"></div>
        </div>

        <!-- â”€â”€ Danger Zone: Delete Application â”€â”€ -->
        <div class="danger-zone">
          <h4>âš ï¸ Danger Zone</h4>
          <p>Permanently delete this application and all its stage data. This action cannot be undone.</p>
          <button id="deleteApp" class="btn-delete-app">
            ğŸ—‘ï¸ Delete Application
          </button>
        </div>

      </section>
    </main>

    <!-- STAGE MODAL -->
    <div id="stageModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-stage">&times;</span>
        <h2>Add Stage</h2>
        <div class="form-group">
          <label>Step Number</label>
          <input type="number" id="stageNumber" min="1" />
        </div>
        <div class="form-group">
          <label>Stage Name</label>
          <input type="text" id="stageName" />
        </div>
        <div class="form-group">
          <label>Date</label>
          <input type="date" id="stageDate" />
        </div>
        <div class="form-group">
          <label>Time</label>
          <input type="time" id="stageTime" />
        </div>
        <button id="stageSave" class="btn save">Save</button>
      </div>
    </div>

    <!-- DELETE CONFIRM MODAL -->
    <div id="deleteModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-delete">&times;</span>
        <h2>Delete from list?</h2>
        <div class="form-group"><label id="delProgram">ğŸ·ï¸ Program:</label></div>
        <div class="form-group"><label id="delCompany">ğŸ¢ Company:</label></div>
        <div class="form-group"><label id="delStage">ğŸ“ Stage:</label></div>
        <button id="deleteConfirm" class="btn save" style="background: red">Delete</button>
      </div>
    </div>

    <!-- CUSTOM CONFIRM MODAL -->
    <div id="customConfirmModal" class="modal" style="display: none">
      <div class="modal-content">
        <h2 id="confirmTitle">Confirm</h2>
        <div id="confirmTime"></div>
        <p id="confirmMessage"></p>
        <div>
          <button id="confirmNo" class="btn">No</button>
          <button id="confirmYes" class="btn save" style="background: #e74c3c">Yes</button>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="../assets/js/supabaseClient.js"></script>
    <script src="../assets/js/applicationService.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/profileService.js"></script>
    <script src="../assets/js/experienceService.js"></script>
    <script src="../assets/js/dataService.js"></script>
    <script src="../assets/js/ui.js"></script>
    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/applicationDetailPage.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Dark mode toggle
        const btn = document.getElementById('darkModeToggle');
        const html = document.documentElement;
        function updateIcon() {
          const isDark = html.getAttribute('data-theme') === 'dark';
          btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
          btn.title = isDark ? 'Switch to light mode' : 'Switch to dark mode';
        }
        updateIcon();
        btn.addEventListener('click', function() {
          const isDark = html.getAttribute('data-theme') === 'dark';
          if (isDark) { html.removeAttribute('data-theme'); localStorage.setItem('theme', 'light'); }
          else { html.setAttribute('data-theme', 'dark'); localStorage.setItem('theme', 'dark'); }
          updateIcon();
        });
      });
    </script>
  </body>
</html>
